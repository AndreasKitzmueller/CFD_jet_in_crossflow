# ===========================
# A) Duplicate and extend solver (once, already included in the files on GitHub)
# ===========================

# 1) copy original to the user folder (of the OS)
#    (makes a copy of icoFoam, which we call "icoFoamColored" (since traces are represented by colors))
mkdir -p $WM_PROJECT_USER_DIR/applications/solvers/incompressible
cp -r /usr/lib/openfoam/openfoam2412/applications/solvers/incompressible/icoFoam \
      $WM_PROJECT_USER_DIR/applications/solvers/incompressible/icoFoamColored
cd $WM_PROJECT_USER_DIR/applications/solvers/incompressible/icoFoamColored

# 2) Create file "icoFoamColored/Make/files" (target name & binary path)
#    Copy EXACTLY the text inbetween the --- lines "icoFoamColored/Make/files":
#    --------------------------------------------
#    icoFoam.C
#    EXE = $(FOAM_USER_APPBIN)/icoFoamColored
#    --------------------------------------------

# 3) extend Fields.H (2 tracer + diffusivity)
#    paste after the default fields (nu, p, U, phi, setRefCell, mesh.setFluxRequired…):
#    ---------------------------------------------------------------------------
#    // --- Passive tracer fields for coloring two streams
#    volScalarField cA
#    (
#        IOobject("cA", runTime.timeName(), mesh,
#                 IOobject::READ_IF_PRESENT, IOobject::AUTO_WRITE),
#        mesh, dimensionedScalar("zero", dimless, 0)
#    );
#
#    volScalarField cB
#    (
#        IOobject("cB", runTime.timeName(), mesh,
#                 IOobject::READ_IF_PRESENT, IOobject::AUTO_WRITE),
#        mesh, dimensionedScalar("zero", dimless, 0)
#    );
#
#    // Diffusivity (m^2/s): 0 = only advection; 1e-8..1e-6 for smoothing
#    // variant A: fixed value
#    dimensionedScalar D("D", dimensionSet(0,2,-1,0,0,0,0), 0);
#    // variant B (optional): read from transportProperties
#    // dimensionedScalar D("D", dimViscosity, transportProperties);
#    ---------------------------------------------------------------------------

# 4) icoFoam.C –  solve tracer equations once per time step
#    insert after the PISO loop, BEFORE runTime.write();:
#    ---------------------------------------------------------------------------
#    // --- Passive tracer transport (once per time step)
#    {
#        fvScalarMatrix cAEqn( fvm::ddt(cA) + fvm::div(phi, cA) - fvm::laplacian(D, cA) );
#        cAEqn.relax(); cAEqn.solve();
#
#        fvScalarMatrix cBEqn( fvm::ddt(cB) + fvm::div(phi, cB) - fvm::laplacian(D, cB) );
#        cBEqn.relax(); cBEqn.solve();
#    }
#    ---------------------------------------------------------------------------
#
#    (Optional, useful for checking: a log line directly at the beginning of the time loop)
#    ---------------------------------------------------------------------------
#    Info<< ">>> icoFoamColored: tracer build active <<<" << endl;
#    ---------------------------------------------------------------------------

# 5) Building
wclean
wmake

# Check if the binary exists:
which icoFoamColored
ls -l ~/OpenFOAM/$USER-v2412/platforms/linux64GccDPInt32Opt/bin/icoFoamColored


# ===========================
# B) case files (per case)
# ===========================
# Assumed patches (from boundary):
#   inletMain (inflow A), jetInlet (inflow B), outlet,
#   walls: top, floor, sideWalls, ductWalls
#
# Note: 0/cA and 0/cB are FIELD files (volScalarField) in folder 0/ (time step 0).
# fvSchemes/fvSolution/controlDict are in system/.
# transportProperties is in constant/.

# --------------------------------------------------
# 1) 0/cA
# --------------------------------------------------
# FoamFile{version 2.0; format ascii; class volScalarField; object cA;}
# dimensions      [0 0 0 0 0 0 0];
# internalField   uniform 0;
# boundaryField
# {
#     inletMain   { type fixedValue; value uniform 1; }
#     jetInlet    { type fixedValue; value uniform 0; }
#     outlet      { type zeroGradient; }
#     top         { type zeroGradient; }
#     floor       { type zeroGradient; }
#     sideWalls   { type zeroGradient; }
#     ductWalls   { type zeroGradient; }
# }

# --------------------------------------------------
# 2) 0/cB
# --------------------------------------------------
# FoamFile{version 2.0; format ascii; class volScalarField; object cB;}
# dimensions      [0 0 0 0 0 0 0];
# internalField   uniform 0;
# boundaryField
# {
#     inletMain   { type fixedValue; value uniform 0; }
#     jetInlet    { type fixedValue; value uniform 1; }
#     outlet      { type zeroGradient; }
#     top         { type zeroGradient; }
#     floor       { type zeroGradient; }
#     sideWalls   { type zeroGradient; }
#     ductWalls   { type zeroGradient; }
# }
# (If A/B are exchanged: switch the 1/0 at the inlets.)

# --------------------------------------------------
# 3) system/fvSchemes  (laminar, minimal, clean)
# --------------------------------------------------
# FoamFile{version 2.0; format ascii; class dictionary; object fvSchemes;}
# ddtSchemes        { default backward; }
# gradSchemes       { default Gauss linear; }
# divSchemes
# {
#     div(phi,U)      Gauss linearUpwind grad(U);
#     div(phi,cA)     Gauss upwind;
#     div(phi,cB)     Gauss upwind;
# }
# laplacianSchemes
# {
#     default         Gauss linear corrected;
#     laplacian(nu,U) Gauss linear corrected;
#     laplacian(D,cA) Gauss linear corrected;
#     laplacian(D,cB) Gauss linear corrected;
# }
# interpolationSchemes { default linear; }
# snGradSchemes        { default corrected; }

# --------------------------------------------------
# 4) system/fvSolution
# --------------------------------------------------
# FoamFile{format ascii; class dictionary; object fvSolution;}
# solvers
# {
#     p       { solver PCG; preconditioner DIC; tolerance 1e-6; relTol 0.05; }
#     pFinal  { $p; relTol 0; }
#
#     U       { solver smoothSolver; smoother symGaussSeidel; tolerance 1e-5; relTol 0; }
#
#     cA      { solver smoothSolver; smoother symGaussSeidel; tolerance 1e-8; relTol 0.1; }
#     cAFinal { $cA; relTol 0; }
#
#     cB      { solver smoothSolver; smoother symGaussSeidel; tolerance 1e-8; relTol 0.1; }
#     cBFinal { $cB; relTol 0; }
# }
# PISO
# {
#     nCorrectors 2;
#     nNonOrthogonalCorrectors 2;
# }

# --------------------------------------------------
# 5) constant/transportProperties
# --------------------------------------------------
# variant A (D fixed in solver = 0) → nothing more needed.
# variant B (read D from Dict) → add:
# D   [0 2 -1 0 0 0 0]  0;    # or e.g. 1e-8 for slight smoothing
